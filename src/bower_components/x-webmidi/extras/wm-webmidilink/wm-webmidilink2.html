<!--
Copyright (c) 2015 Ryoya Kawai. All rights reserved.
Distributed under the MIT License (license terms are at http://opensource.org/licenses/MIT).
-->
<dom-module id="wm-webmidilink">
  <style>
  #target-synth {
    border:solid 0px;
    background-color:rgba(255, 255, 255, 1);
    height:0px;
    transition:0.5s;
  }
  #window-area {
    position:absolute;
    border:1px solid #666;
    height:0px;
    transition:0.5s;
  }
  #window-grab-area {
    border:1px solid #666;
    font-family:Arial;
    color:#eee;
    padding:3px;
    text-align:right;
    position:relative;
    background-color:#666;
    height:20px;
    cursor:pointer;
  }
  #open-button {
    padding:3px;
    margin:3px;
    outline:none;
  }
  </style>
  <template>
    <div id="window-area">
      <div id="window-grab-area"><button id="window-ctrl-button">Open</button></div>
      <iframe src={{targetsynth}} id="target-synth"></iframe>
    </div>
  </template>
</dom-module>
<script type="text/javascript">
Polymer({
    is:"wm-webmidilink",
    properties: {
        targetsynth: {
            type: String,
            value: "http://www.g200kg.com/webmidilink/gmplayer/"
        }
    },
    ready: function() {
        console.log("AA");
        this.postTarget=this.$["targetSynth"];
        var drag=false;
    },
    attached: function() {
        // used be a domReady
        var drag=false;
        var dragStart={"x":0, "y":0};
        var targetSynth=this.$["target-synth"];
        var windowArea=this.$["window-area"];
        var windowOpen=false;
        this.async(function() {
            window.addEventListener("mouseup", function(event){
                drag=false;
            });
            this.$["window-grab-area"].addEventListener("mousedown", function(event){
                drag=true;
                dragStart={"x":event.clientX, "y":event.clientY};
                console.log("mousedown");
            });
            this.$["window-grab-area"].addEventListener("mousemove", function(event){
                if(drag===true) {
                    var dx=event.clientX-dragStart.x, dy=event.clientY-dragStart.y;
                    var rect = event.target.getBoundingClientRect();
                    console.log(event.target.style, rect.left, rect.top, dx, dy);
                    event.target.style.setProperty("left", (rect.left+dx)+"px");
                    event.target.style.setProperty("top", (rect.top+dy)+"px");
                }
            });
            this.$["window-ctrl-button"].addEventListener("mousedown", function(event){
                if(windowOpen===true) {
                    windowArea.style.setProperty("border", "1px solid #666;");
                    targetSynth.style.setProperty("height", "0px");
                    windowArea.style.setProperty("height", "0px");
                    windowOpen=false;
                } else {
                    windowArea.style.removeProperty("border");
                    targetSynth.style.setProperty("height", "100px");
                    windowArea.style.setProperty("height", "128px");
                    windowOpen=true;
                }
            });

        });
    },
});
</script>