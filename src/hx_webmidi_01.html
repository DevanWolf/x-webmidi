<html>
  <head></head>
  <body>
    <script src="bower_components/webcomponentsjs/webcomponents.js"></script>
    <link rel="import" href="bower_components/polymer/polymer.html">
    <link rel="import" href="bower_components/x-webmidi/extras/wm-webmidilink/wm-webmidilink.html">
    <link rel="import" href="bower_components/x-webmidi/extras/wm-pckeyboard/wm-pckeyboard.html">

    <wm-webmidilink id="wmlink"></wm-webmidilink>
    <wm-pckeyboard id="pckeyboard"></wm-pckeyboard>

    input: <select id="midi-input"><option value="false">SelectOne</option></select><br>
    output: <select id="midi-output"><option>SelectOne</option></select>
    <br>

    <script type="text/javascript">
    var wmlinkDevice=(document.querySelector("#wmlink")).getOutput();
    var wmPckbdDevice=(document.querySelector("#pckeyboard")).getInput();

    var midi={"inputs":[], "outputs":[]};
    var outputSelIdx=null;
    var inputSelIdx=null;
    navigator.requestMIDIAccess({sysex:false}).then(successCallback, errorCallback);
    function successCallback(access) {
        var inputIterator = access.inputs.values();
        for (var o = inputIterator.next(); !o.done; o = inputIterator.next()) {
            midi.inputs.push(o.value)
        }
        var outputIterator = access.outputs.values();
        for (var o = outputIterator.next(); !o.done; o = outputIterator.next()) {
            midi.outputs.push(o.value);
        }

        // outputs
        midi.outputs.push(wmlinkDevice);
        var osel=document.querySelector("#midi-output");
        for(var i=0; i<midi.outputs.length; i++) {
            osel.appendChild((new Option(midi.outputs[i]["name"], i)));
        }
        osel.addEventListener("change", function(event){
            outputSelIdx=event.target.value;
        });

        // inputs
        var inputSelIdx;
        midi.inputs.push(wmPckbdDevice);
        var isel=document.querySelector("#midi-input");
        for(var i=0; i<midi.inputs.length; i++) {
            isel.appendChild(new Option(midi.inputs[i]["name"], i));
        }
        isel.addEventListener("change", function(event){
            if(inputSelIdx!=null) {
                midi.inputs[inputSelIdx].onmidimessage=null;
            }
            inputSelIdx=event.target.value;
            midi.inputs[event.target.value].onmidimessage=eventOut;
        });
        function eventOut(event) {
            if(outputSelIdx!=null) {
                midi.outputs[outputSelIdx].send(event.data);
            }
        }

    }
    function errorCallback(msg) {
        console.log("[ERROR] ", msg);
    }
    </script>

  </body>
</html>